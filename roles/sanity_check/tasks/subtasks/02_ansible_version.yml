#########################################################################
# Title:         Cloudbox: Sanity Check | Ansible Version               #
# Author(s):     desimaniac, salty                                      #
# URL:           https://github.com/cloudbox/cloudbox                   #
# --                                                                    #
#         Part of the Cloudbox project: https://cloudbox.works          #
#########################################################################
#                   GNU General Public License v3.0                     #
#########################################################################
---
- name: Print Ansible version
  debug:
    msg: "Installed Ansible version: {{ ansible_version.full }}."

- name: Check if Ansible needs upgrading
  set_fact:
    ansible_update: true
  when: ansible_version.full is version(sanity_check_ansible_version_min, '<=')

- name: Upgrade Ansible
  script:
    cmd: /srv/git/cloudbox/scripts/update.sh
  become: true
  become_user: root
  when: ansible_update

- name: "Upgrade Ansible | Check if Ansible was upgraded"
  block:
  - name: "Upgrade Ansible | Print Instructions"
    debug:
      msg:
        - "Ansible was upgraded"
        - "You will need to re-run your previous tag."

  - name: "Upgrade Ansible | Exit"
    meta: end_play
  when: ansible_update
