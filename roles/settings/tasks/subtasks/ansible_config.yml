#########################################################################
# Title:         Settings: Ansible Config                               #
# Author(s):     l3uddz, desimaniac                                     #
# URL:           https://github.com/cloudbox/cloudbox                   #
# --                                                                    #
#         Part of the Cloudbox project: https://cloudbox.works          #
#########################################################################
#                   GNU General Public License v3.0                     #
#########################################################################
---
- name: "Ansible Config | Check if '{{ item }}' exists."
  stat:
    path: "{{ playbook_dir }}/{{ item }}"
  register: file

- name: "Ansible Config | Copy '{{ item }}.default' to '{{ item }}'."
  copy:
    src: "{{ playbook_dir }}/defaults/{{ item }}.default"
    dest: "{{ playbook_dir }}/{{ item }}"
    owner: "{{ cloudbox_yml.stat.uid }}"
    group: "{{ cloudbox_yml.stat.gid }}"
    mode: 0664
    force: yes
  when: not file.stat.exists

- name: "Ansible Config | Add hash_behaviour into '{{ item }}'."
  lineinfile:
    path: "{{ playbook_dir }}/{{ item }}"
    regexp: '^hash_behaviour\s?=.*'
    state: present
    line: 'hash_behaviour = merge'
  when: file.stat.exists
